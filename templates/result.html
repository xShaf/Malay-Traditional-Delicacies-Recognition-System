{% extends "base.html" %}
{% block content %}

<div class="mb-6">
    <a href="{{ url_for('main.recognize') }}" class="btn btn-sm gap-2 hover:bg-base-200">
        <i class="fa-solid fa-arrow-left"></i> Scan Another Delicacy
    </a>
</div>

<div id="result-skeleton" class="animate-pulse">
    <!-- Skeleton code same as recognize.html, omitting for brevity in response but functionally included -->
     <div class="card bg-base-100 shadow-xl mb-8 border-l-8 border-base-300">
        <div class="card-body lg:flex-row gap-8 items-start p-8">
            <div class="w-full lg:w-80 flex-shrink-0">
                <div class="w-full h-72 bg-base-300 rounded-xl flex items-center justify-center"><i class="fa-regular fa-image text-4xl text-base-content/20"></i></div>
            </div>
            <div class="flex-1 flex flex-col justify-center w-full py-2 gap-6">
                <div class="h-8 bg-base-300 rounded w-1/4"></div>
                <div class="h-12 bg-base-300 rounded w-3/4"></div>
                <div class="h-24 bg-base-300 rounded w-full"></div>
            </div>
        </div>
    </div>
</div>

<div id="result-content" class="hidden">

    <!-- HEADLINE GROUP -->
    <div class="card bg-base-100 shadow-xl mb-8 border-l-8 border-primary overflow-hidden">
        <div class="card-body lg:flex-row gap-8 items-start p-8">

            <!-- Image Area -->
            <div class="w-full lg:w-80 flex-shrink-0">
                <figure>
                    <img src="{{ url_for('static', filename='uploads/' + result.image) }}"
                         alt="{{ result.class }}"
                         onload="revealContent()"
                         class="w-full h-72 object-cover rounded-xl shadow-lg border-4 border-base-200 hover:scale-105 transition-transform duration-300">
                </figure>
            </div>

            <!-- Text Area -->
            <div class="flex-1 flex flex-col justify-center h-full py-2">
                <div class="flex items-center gap-2 mb-4">
                    <div class="badge badge-success badge-lg gap-2 text-white font-bold shadow-sm">
                        <i class="fa-solid fa-circle-check"></i>
                        Match: {{ result.confidence }}
                    </div>
                </div>
                <h1 class="text-5xl font-extrabold text-gray-900 mb-6 tracking-tight">{{ result.class }}</h1>
                <blockquote class="text-xl text-gray-600 italic border-l-4 border-primary pl-6 py-2 bg-base-200 rounded-r-lg">
                    <i class="fa-solid fa-quote-left text-primary/40 mr-2"></i> {{ info.description }}
                </blockquote>
            </div>
        </div>
    </div>

    <!-- DETAILS GRID -->
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8 items-start">

        <!-- LEFT COLUMN -->
        <div class="flex flex-col gap-6 lg:col-span-1">

            {% if info and info.ingredients %}
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body p-5">
                    <h2 class="card-title text-secondary flex items-center gap-2 text-lg">
                        <i class="fa-solid fa-basket-shopping"></i> Ingredients
                    </h2>
                    <div class="divider my-0"></div>
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200 mt-2 text-sm">
                        <div class="prose max-w-none text-gray-800 font-medium whitespace-pre-line leading-6">
                            {{ info.ingredients }}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            {% if session.get('user_id') %}
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body p-5">
                    <h2 class="card-title flex items-center gap-2 text-lg">
                        <i class="fa-solid fa-star"></i> Rate
                    </h2>
                    <form action="/feedback" method="POST" class="mt-2">
                        <div class="flex flex-col items-center p-3 bg-base-200 rounded-xl mb-4">
                            <h3 class="font-bold text-xs mb-2 text-gray-500 uppercase">Accuracy</h3>
                            <div class="rating rating-md">
                                <input type="radio" name="rating" class="mask mask-star-2 bg-orange-400" value="1" />
                                <input type="radio" name="rating" class="mask mask-star-2 bg-orange-400" value="2" />
                                <input type="radio" name="rating" class="mask mask-star-2 bg-orange-400" value="3" checked />
                                <input type="radio" name="rating" class="mask mask-star-2 bg-orange-400" value="4" />
                                <input type="radio" name="rating" class="mask mask-star-2 bg-orange-400" value="5" />
                            </div>
                        </div>
                        <textarea name="comment" class="textarea textarea-bordered w-full h-20 text-sm" placeholder="Comments..."></textarea>
                        <button class="btn btn-secondary btn-sm btn-block mt-4"><i class="fa-solid fa-paper-plane"></i> Submit</button>
                    </form>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- RIGHT COLUMN -->
        <div class="flex flex-col gap-6 lg:col-span-3">

            {% if info and info.history %}
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-accent flex items-center gap-2">
                        <i class="fa-solid fa-scroll"></i> History & Culture
                    </h2>
                    <div class="divider my-0"></div>
                    <p class="leading-relaxed text-gray-700 whitespace-pre-wrap text-justify mt-2 text-lg">{{ info.history }}</p>
                </div>
            </div>
            {% endif %}

            {% if info and info.recipe %}
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-accent flex items-center gap-2">
                        <i class="fa-solid fa-fire-burner"></i> Preparation Steps
                    </h2>
                    <div class="divider my-0"></div>
                    <div class="prose prose-lg max-w-none text-gray-700 whitespace-pre-line mt-2">
                        {{ info.recipe }}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    function revealContent() {
        const skeleton = document.getElementById('result-skeleton');
        const content = document.getElementById('result-content');
        setTimeout(() => {
            skeleton.classList.add('hidden');
            content.classList.remove('hidden');
            content.classList.add('animate-fade-in');
        }, 500);
    }
    setTimeout(revealContent, 1000);
</script>

{% endblock %}